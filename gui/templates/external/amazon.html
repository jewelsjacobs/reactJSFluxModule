{% extends "web_app_base.html" %}

{% block nav_secondary %}
    {% call nav_secondary_content() %}
        {% include "external/external_secondary_nav.html" %}
    {% endcall %}
{% endblock %}

{% block sidebar %}
    {% call sidebar_help(hidden=False) %}
        <h3>Amazon Integration Help</h3>
        <span class="rs-help-block">After adding a valid Access Key, ObjectRocket will automatically create an ACL on
            each of your instances for every EC2 public and Elastic IP address visible to this Access Key. You can
            disable ACLSync for a specific instance on that instance's settings page.</span>
    {% endcall %}
{% endblock sidebar %}

{% block content_area_body %}


{% call detail_header(page_title="External Integration Settings") %}{% endcall %}
    {% set action = 'add_ec2_settings' %}
    {% if obfuscated_ec2_access_key %}
        {% set action = 'delete_ec2_settings' %}
    {% endif %}
{% call create_view(url_for(action), id="ec2_settings_form", method="POST") %}

        {% call detail_section(title="Amazon ACLSync", subtitle="Automatically create and delete ACLs as your environment changes.") %}
            <div class="rs-detail-section-body">

                            <div class="rs-control-group">
                    <label class="rs-control-label" for="ec2_region">AWS Region</label>

                    <div class="rs-controls">
                        <select name="ec2_region" id="ec2_region">
                            <option value="us-east-1" selected>us-east-1</option>
                            <option value="us-west-1">us-west-1</option>
                            <option value="us-west-2">us-west-2</option>
                            <option value="eu-west-1">eu-west-1</option>
                            <option value="ap-northeast-1">ap-northeast-1</option>
                            <option value="ap-southeast-1">ap-southeast-1</option>
                            <option value="ap-southeast-2">ap-southeast-2</option>
                            <option value="sa-east-1">sa-east-1</option>
                            <option value="us-gov-west-1">us-gov-west-1</option>
                        </select>
                        <span class="rs-help-block">See
                        <a href="http://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Concepts.RegionsAndAvailabilityZones.html">
                            Regions and Availability Zones</a> for more information.
                        </span>
                    </div>

                </div>


                <div class="rs-control-group">
                    <label class="rs-control-label" for="ec2_access_key">Access Key ID</label>
                    <div class="rs-controls">
                        {% if obfuscated_ec2_access_key %}
                            <input type="text" name="ec2_access_key" class="rs-input-xlarge" readonly
                                    placeholder="{{ obfuscated_ec2_access_key }}">
                        {% else %}
                            <input type="text" name="ec2_access_key" class="rs-input-xlarge" id="ec2_access_key">
                        {% endif %}
                    </div>
                </div>


                <div class="rs-control-group">
                    <label class="rs-control-label" for="ec2_secret_key">Secret Access Key</label>

                    <div class="rs-controls">
                        {% if obfuscated_ec2_secret_key %}
                            <input type="text" name="ec2_secret_key" class="rs-input-xlarge" readonly
                                    placeholder="{{ obfuscated_ec2_secret_key }}">
                        {% else %}
                            <input class="rs-input-xlarge" type="text" name="ec2_secret_key" id="ec2_secret_key">
                        {% endif %}
                        <span class="rs-help-block">For security purposes, use a read-only key pair. See
                        <a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/ManagingCredentials.html">
                            Administering Access Keys for IAM Users</a> for more information.
                        </span>
                        <br>

                    </div>
                </div>
                <div class="rs-control-group">
                    <div class="rs-controls">
                        {% if obfuscated_ec2_access_key %}
                            <button type="submit" id="ec2_settings_button" class="rs-btn rs-btn-primary">Delete AWS Access Key
                            </button>
                        {% else %}
                            <button type="submit" id="ec2_settings_button" disabled="disabled"
                                    class="rs-btn rs-btn-primary">Set AWS Access Key
                            </button>
                        {% endif %}
                    </div>
                </div>

            </div>
            {% endcall %}
    {% endcall %}
{% endblock %}

{% block script %}
    {{ super() }}
<script>
$(document).ready(function(){

    $('#ec2_settings_form').validate({
        rules: {
            ec2_access_key: {
                required: true
            },
            ec2_secret_key: {
                required: true
            }
        },
        errorClass: 'rs-validation-block',
        errorElement: 'span',
        highlight: function (label) {
            $(label).closest('.rs-control-group').addClass('error');
        },
        success: function (label) {
                $(label).closest('.rs-control-group').addClass('success');
                $(label).closest('.rs-control-group').removeClass('error');
        }
    });

    $('#ec2_settings_form').bind("change keyup", function () {
        if ($(this).validate().checkForm()) {
            $("#ec2_settings_button").attr('disabled', false);
        } else {
            $('#ec2_settings_button').attr('disabled', true);
        }
    });

});
</script>

{% endblock %}