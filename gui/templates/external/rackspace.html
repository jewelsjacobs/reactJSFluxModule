{% extends "web_app_base.html" %}

{% block nav_secondary %}
    {% call nav_secondary_content() %}
        {% include "external/external_secondary_nav.html" %}
    {% endcall %}
{% endblock %}

{% block sidebar %}
    {% call sidebar_help(hidden=False) %}
        <h3>Rackspace Help</h3>
        <span class="rs-help-block"></span>
    {% endcall %}
{% endblock sidebar %}

{% block content_area_body %}


{% call detail_header(page_title="External Integration Settings") %}{% endcall %}
    {% set action = 'add_rax_settings' %}
    {% if obfuscated_rax_access_key %}
        {% set action = 'delete_rax_settings' %}
    {% endif %}
{% call create_view(url_for(action), id="rax_settings_form", method="POST") %}

        {% call detail_section(title="Rackspace", subtitle="Automatically create and delete ACLs as your environment changes.") %}
            <div class="rs-detail-section-body">

                <div class="rs-control-group">
                    <label class="rs-control-label" for="rax_username">Username</label>
                    <div class="rs-controls">
                        {% if rax_username %}
                            <input type="text" name="rax_username" class="rs-input-xlarge" disabled value="{{ rax_username }}">
                        {% else %}
                            <input type="text" name="rax_username" class="rs-input-xlarge" id="rax_username">
                        {% endif %}
                    </div>
                </div>


                <div class="rs-control-group">
                    <label class="rs-control-label" for="rax_api_key">API Key</label>

                    <div class="rs-controls">
                        {% if obfuscated_rax_api_key %}
                            <input type="text" name="rax_api_key" class="rs-input-xlarge" disabled value="{{ obfuscated_rax_api_key }}">
                        {% else %}
                            <input class="rs-input-xlarge" type="text" name="rax_api_key" id="rax_api_key">
                        {% endif %}
                    </div>
                </div>

                <div class="rs-control-group">
                    <div class="rs-controls">
                        {% if obfuscated_rax_api_key %}
                            <button type="submit" id="rax_settings_button" class="rs-btn rs-btn-primary">Delete Rackspace API Key</button>
                        {% else %}
                            <button type="submit" id="rax_settings_button" disabled class="rs-btn rs-btn-primary">Set Rackspace API Key</button>
                        {% endif %}
                    </div>
                </div>

            </div>
            {% endcall %}
    {% endcall %}
{% endblock %}

{% block script %}
    {{ super() }}
<script>
$(document).ready(function(){

    $('#rax_settings_form').validate({
        rules: {
            rax_username: {
                required: true
            },
            rax_api_key: {
                required: true
            }
        },
        errorClass: 'rs-validation-block',
        errorElement: 'span',
        highlight: function (label) {
            $(label).closest('.rs-control-group').addClass('error');
        },
        success: function (label) {
                $(label).closest('.rs-control-group').addClass('success');
                $(label).closest('.rs-control-group').removeClass('error');
        }
    });

    $('#rax_settings_form').bind("change keyup", function () {
        if ($(this).validate().checkForm()) {
            $("#rax_settings_button").attr('disabled', false);
        } else {
            $('#rax_settings_button').attr('disabled', true);
        }
    });

});
</script>

{% endblock %}
