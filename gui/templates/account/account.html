{% extends 'web_app_base.html' %}

{% block title %}
    Account
{% endblock title %}

{% block sidebar %}
    {% call sidebar_help(hidden=False) %}
        <h3>Account Settings Help</h3>
        <h4>Login Details</h4>
        <p>To update your login password, click on the edit icon next to the password field. You will need to use the new password next time you log in.</p>

        <hr>
        <h4>Contact Information</h4>
        <p>To update your contact information, click on the edit icon next to the section header. This will update your contact information in our system.</p>

        <br>
        <h5><a target="blank" href="http://docs.objectrocket.com/">Visit Our Knowledge Center &raquo;</a></h5>
    {% endcall %}
{% endblock sidebar %}

{% block content_area_body %}
    <div class="rs-detail-section">
        <div class="rs-detail-section-header">
            <div class="rs-detail-header-actions">
                <!-- This could be in its own rs-detail-header, but it is here for a more compact look. -->
                <div class="rs-dropdown">
                    <button class="rs-btn rs-btn-action rs-dropdown-toggle">
                        <span class="rs-cog"></span>
                        Actions
                        <span class="rs-caret"></span>
                    </button>
                    <ul class="rs-dropdown-menu" style="right:0;">
                        <li><span class="rs-dropdown-category">Manage</span></li>
                        <li><a data-popover="update-password-popover" data-popover-target="update-password-target" data-popover-position="right" class="rs-btn rs-btn-link rs-popover-source">Update Password</a></li>
                        <li><a data-popover="contact-information-popover" data-popover-target="contact-information-target" data-popover-position="right" class="rs-btn rs-btn-link rs-popover-source">Update Info</a></li>
                    </ul>
                </div>
            </div>
            <!-- This rs-page-title could be in the above mentioned rs-detail-header, but it is here for a more compact look. -->
            <h2 class="rs-page-title">Account Settings</h2>
            <div id="update-password-target" class="rs-detail-section-title">Login Details</div>
        </div>

        <div class="rs-detail-section-body">
            <ul class="rs-detail-list">
                <li class="rs-detail-item">
                    <div class="rs-detail-key">Password</div>
                    <div class="rs-detail-value">
                        <span class="password-content">••••••••••••</span>
                    </div>
                </li>
            </ul>
        </div>
    </div>

    <div class="rs-detail-section">
        <div class="rs-detail-section-header">
            <div id="contact-information-target" class="rs-detail-section-title">Contact Information</div>
        </div>

        <div class="rs-detail-section-body">
            <ul class="rs-detail-list">
                <li class="rs-detail-item">
                    <div class="rs-detail-key">Name</div>
                    <div class="rs-detail-value">{{ account.name }}</div>
                </li>

                <li class="rs-detail-item">
                    <div class="rs-detail-key">Email</div>
                    <div class="rs-detail-value">{{ account.email }}</div>
                </li>

                <li class="rs-detail-item">
                    <div class="rs-detail-key">Phone</div>
                    <div class="rs-detail-value">{{ account.phone }}</div>
                </li>

                <li class="rs-detail-item">
                    <div class="rs-detail-key">Company</div>
                    <div class="rs-detail-value">{{ account.company }}</div>
                </li>

                <li class="rs-detail-item">
                    <div class="rs-detail-key">Zip Code</div>
                    <div class="rs-detail-value">{{ account.zipcode }}</div>
                </li>
            </ul>
        </div>
    </div>
    {% if show_cc_form %}
        {% include 'billing/cc_details.html' %}
    {% endif %}
{% endblock content_area_body %}

{% block popovers %}
    <div id="contact-information-popover" class="rs-popover invisible">
        <div class="rs-popover-arrow"></div>
        <div class="rs-popover-content">
            <div class="rs-popover-body">
                <form id="contact-information-popover-form" class="rs-form-horizontal rs-form-small" action="{{ url_for('update_account_contact') }}" method="POST">
                    <div class="rs-control-group">
                        <label class="rs-control-label">Name</label>
                        <div class="rs-controls">
                            <input name="name" type="text" class="rs-input rs-input-medium" value="{{ account.name or '' }}">
                        </div>
                    </div>
                    <div class="rs-control-group">
                        <label class="rs-control-label">Email</label>
                        <div class="rs-controls">
                            <input name="email" type="text" class="rs-input rs-input-medium" value="{{ account.email or '' }}">
                        </div>
                    </div>
                    <div class="rs-control-group">
                        <label class="rs-control-label">Phone</label>
                        <div class="rs-controls">
                            <input name="phone" type="text" class="rs-input rs-input-medium" value="{{ account.phone or '' }}">
                        </div>
                    </div>
                    <div class="rs-control-group">
                        <label class="rs-control-label">Company</label>
                        <div class="rs-controls">
                            <input name="company" type="text" class="rs-input rs-input-medium" value="{{ account.company or '' }}">
                        </div>
                    </div>
                    <div class="rs-control-group">
                        <label class="rs-control-label">Zip</label>
                        <div class="rs-controls">
                            <input name="zipcode" type="text" class="rs-input rs-input-medium" value="{{ account.zipcode or '' }}">
                        </div>
                    </div>
                </form>
            </div>
            <div class="rs-popover-footer rs-btn-group">
                <button id="contact-information-popover-form-button" form="contact-information-popover-form" class="rs-btn rs-btn-primary save">Save</button>
                <div class="rs-btn rs-btn-link">Cancel</div>
            </div>
        </div>
    </div>

    <div id="update-password-popover" class="rs-popover invisible">
        <div class="rs-popover-arrow"></div>
        <div class="rs-popover-content">
            <div class="rs-popover-body">
                <form id="update-password-popover-form" class="rs-form-horizontal rs-form-small" action="{{ url_for('update_password') }}" method="POST">
                    <div class="rs-control-group">
                        <label class="rs-control-label">New Password</label>
                        <div class="rs-controls">
                            <input id="password" name="password" type="password" class="rs-input rs-input-medium">
                        </div>
                    </div>
                    <div class="rs-control-group">
                        <label class="rs-control-label">Confirm New Password</label>
                        <div class="rs-controls">
                            <input name="confirm-password" type="password" class="rs-input rs-input-medium">
                        </div>
                    </div>
                </form>
            </div>
            <div class="rs-popover-footer rs-btn-group">
                <button id="update-password-form-button" form="update-password-popover-form" class="rs-btn rs-btn-primary save">Save</button>
                <div class="rs-btn rs-btn-link">Cancel</div>
            </div>
        </div>
    </div>
{% endblock popovers %}

{% block script %}
    {{ super() }}
    {% if show_cc_form %}
        {% include 'stripe_js.html' %}
    {% endif %}
    <script type="text/javascript">
    $(document).ready(function() {

        $('#contact-information-popover-form').validate({
            rules: {
                name: {
                    required: true
                },
                email: {
                    email: true,
                    required: true
                },
                phone: {
                    required: true
                },
                company: {
                    required: true
                },
                zipcode: {
                    required: true
                }
            },
            errorClass: 'rs-validation-block',
            errorElement: 'span',
            highlight: function (label) {
                $(label).closest('.rs-control-group').removeClass('success');
                $(label).closest('.rs-control-group').addClass('error');
            },
            success: function (label) {
                $(label).closest('.rs-control-group').removeClass('error');
                $(label).closest('.rs-control-group').addClass('success');
            }
        });

        $('#update-password-popover-form').validate({
            rules: {
                'password': {
                    minlength: 6,
                    required: true
                },
                'confirm-password': {
                    required: true,
                    equalTo: '#password'
                },
            },
            errorClass: 'rs-validation-block',
            errorElement: 'span',
            highlight: function (label) {
                $(label).closest('.rs-control-group').removeClass('success');
                $(label).closest('.rs-control-group').addClass('error');
            },
            success: function(label) {
                $(label).closest('.rs-control-group').removeClass('error')
                $(label).closest('.rs-control-group').addClass('success');
            }
        });
    });
    </script>
{% endblock script %}
